(this.webpackJsonpsnpnz=this.webpackJsonpsnpnz||[]).push([[0],{12:function(e,t,n){},14:function(e,t,n){},16:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),c=n(6),o=n.n(c),s=(n(12),n(0)),i=n.n(s),u=n(3),p=n(4),l=(n(14),n(7)),f="73436",h="ba9fb913d81fc6941fe0d6e96011de332fff2697",d="snpnz_token",w="snpnz_user";function b(){var e={client_id:f,redirect_uri:window.location.origin,response_type:"code",approval_prompt:"auto",scope:"activity:read"},t=new URLSearchParams;return Object.entries(e).forEach((function(e){var n=Object(p.a)(e,2),r=n[0],a=n[1];return t.append(r,a)})),"https://www.strava.com/oauth/authorize?".concat(t.toString())}function v(){return j.apply(this,arguments)}function j(){return(j=Object(u.a)(i.a.mark((function e(){var t,n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=localStorage.getItem(d))||!t.length){e.next=14;break}if(!((n=JSON.parse(t)).expires_at&&1e3*n.expires_at>Date.now())){e.next=5;break}return e.abrupt("return",n.access_token);case 5:if(!n.refresh_token){e.next=11;break}return e.next=8,fetch("https://www.strava.com/api/v3/oauth/token",{body:new URLSearchParams({client_id:f,client_secret:h,refresh_token:n.refresh_token,grant_type:"refresh_token"}).toString(),headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST"}).then((function(e){return e.json()}));case 8:return r=e.sent,localStorage.setItem(d,JSON.stringify(r)),e.abrupt("return",r.access_token);case 11:throw new Error("no token");case 14:throw new Error("no stored token data");case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return O.apply(this,arguments)}function O(){return(O=Object(u.a)(i.a.mark((function e(t){var n,r,a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://www.strava.com/api/v3/oauth/token",{body:new URLSearchParams({client_id:f,client_secret:h,code:t,grant_type:"authorization_code"}).toString(),headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST"}).then((function(e){return e.json()}));case 2:return n=e.sent,console.log({result:n}),r=n.athlete,a=Object(l.a)(n,["athlete"]),localStorage.setItem(w,JSON.stringify(r)),localStorage.setItem(d,JSON.stringify(a)),e.abrupt("return",n.access_token);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var S=n(2);var m=function(){var e=Object(r.useState)(null),t=Object(p.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(!0),o=Object(p.a)(c,2),s=o[0],l=o[1],f=Object(r.useState)(!0),h=Object(p.a)(f,2),d=(h[0],h[1],Object(r.useState)("")),j=Object(p.a)(d,2),O=j[0],m=j[1];return Object(r.useEffect)((function(){var e=new URLSearchParams(window.location.search).get("code");(null===e||void 0===e?void 0:e.length)?function(){var t=Object(u.a)(i.a.mark((function t(){return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l(!0),t.prev=1,t.next=4,g(e);case 4:window.history.pushState({},"","/"),window.location.reload(),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(1),m(t.t0.message),window.location.href=b();case 12:return t.prev=12,l(!1),t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[1,8,12,15]])})));return function(){return t.apply(this,arguments)}}()():function(){var e=Object(u.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(!0),e.prev=1,e.next=4,v();case 4:t=e.sent,a(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0);case 11:return e.prev=11,l(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[1,8,11,14]])})));return function(){return e.apply(this,arguments)}}()()}),[]),s?Object(S.jsx)("div",{children:"Loading..."}):Object(S.jsxs)("div",{className:"App",children:[O&&Object(S.jsx)("p",{children:O}),n&&Object(S.jsx)("pre",{children:JSON.stringify(JSON.parse(localStorage.getItem(w)),null,"\t")}),!n&&Object(S.jsx)("button",{className:"bigButton",onClick:function(){return window.location.href=b()},children:"\u0412\u043e\u0439\u0442\u0438 \u0432 Strava"})]})},k=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,17)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),c(e),o(e)}))};o.a.render(Object(S.jsx)(a.a.StrictMode,{children:Object(S.jsx)(m,{})}),document.getElementById("root")),k()}},[[16,1,2]]]);
//# sourceMappingURL=main.101b6f08.chunk.js.map